# Test font handling                                                 -*-tcl-*-
#
# $Id$

source [file join [file dirname [file join [pwd] [info script]]] init.tcl]

test font-1.1 {font metrics} -body {
    set pdf [pdf4tcl::new %AUTO%]
    $pdf setFont 10 Courier
    set res {}
    lappend res [$pdf getFontMetric bboxy]
    lappend res [$pdf getFontMetric fixed]
    lappend res [$pdf getFontMetric ascend]
    lappend res [$pdf getFontMetric descend]
    lappend res [$pdf getFontMetric height]

    $pdf setFont 20
    lappend res [$pdf getFontMetric bboxy]
    lappend res [$pdf getFontMetric fixed]
    lappend res [$pdf getFontMetric ascend]
    lappend res [$pdf getFontMetric descend]
    lappend res [$pdf getFontMetric height]

    $pdf destroy
    set res
} -result {-2.5 1 6.29 -1.57 10.0 -5.0 1 12.58 -3.14 20.0}

test font-2.1 {font size, units works} -body {
    mytest {setFont 10 Courier} {setFont 20mm Courier} {
        /Courier 10 Tf * /Courier 56.693 Tf
    }
} -result 1

test font-3.1 {font, unicode} -body {
    set cmds [list [list setFont 10 Courier]]
    for {set code 32} {$code <= 255} {incr code} {
        set l [expr {($code-32) % 4}]
        set h [expr {($code-32) / 4}]
        set char [format %c $code]
        set cpchar [encoding convertfrom cp1252 $char]
        set cpcode [scan $cpchar %c]
        set hex  [format %04X $cpcode]
        if {[info exists ::pdf4tcl::glyph_names($hex)]} {
            set glyph $::pdf4tcl::glyph_names($hex)
        } else {
            set glyph "---"
        }
        lappend cmds [list text "$hex '$cpchar' $glyph" \
                -x [expr {$l * 130}] -y [expr {$h * 14}]]
    }

    eval mytest $cmds [list "*20AC '\u0080' euro*"]
} -result 1

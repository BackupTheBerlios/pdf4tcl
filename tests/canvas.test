# Test canvas commands                                               -*-tcl-*-
#
# $Id$

source [file join [file dirname [file join [pwd] [info script]]] init.tcl]

package require Tk
wm withdraw .

test canvas-1.1 {basic} -body {
    canvas .c
    .c create line 10 10 80 80
    .c create rectangle 20 20 50 60 -fill red -outline blue
    mytest {canvas .c} {
        0 0 0 RG 0 0 0 rg 1 w 1 j 10 10 m 80 80 l S
        *
        0 0 1 RG 1 0 0 rg 1 w 20 20 30 40 re B
    }
} -cleanup {destroy .c} -result 1

test canvas-1.2 {basic} -body {
    canvas .c
    .c create line 10 10 80 80
    .c create rectangle 20 20 50 60 -fill red -outline blue
    mytest -orient 1 {canvas .c -x 20 -y 20 -width 200 -height 200} {
        0 0 0 RG 0 0 0 rg 1 w 1 j 10 10 m 80 80 l S
        *
        0 0 1 RG 1 0 0 rg 1 w 20 20 30 40 re B
    }
} -cleanup {destroy .c} -result 1

test canvas-1.3 {basic} -body {
    canvas .c
    .c create line 10 10 80 80
    .c create rectangle 20 20 50 60 -fill red -outline blue
    mytest {canvas .c -x 20 -y 20 -width 200 -height 200} {
        0 0 0 RG 0 0 0 rg 1 w 1 j 10 10 m 80 80 l S
        *
        0 0 1 RG 1 0 0 rg 1 w 20 20 30 40 re B
    }
} -cleanup {destroy .c} -result 1

test canvas-1.4 {basic} -body {
    canvas .c
    .c create line 10 10 80 80
    .c create rectangle 20 20 50 60 -fill red -outline blue
    mytest {canvas .c -bbox {25 15 45 60}} {
        0 0 0 RG 0 0 0 rg 1 w 1 j 10 10 m 80 80 l S
        *
        0 0 1 RG 1 0 0 rg 1 w 20 20 30 40 re B
    }
} -cleanup {destroy .c} -result 1

test canvas-2.1 {image} -body {
    canvas .c
    image create photo img1 -file images/logo125.gif
    .c create rectangle 0 0 250 260 -fill red -outline blue
    .c create image 10 10 -image img1 -anchor nw
    mytest {canvas .c} {
        q * cm * Do Q
    }
    # This only tested the presence of an image. Should be improved...
} -cleanup {destroy .c} -result 1

test canvas-2.2 {bitmap} -body {
    canvas .c
    .c create rectangle 0 0 250 260 -fill red -outline blue
    .c create bitmap 10 10 -bitmap @../bitmaps/hourglass.xbm -anchor nw \
            -background blue -foreground yellow
    mytest {canvas .c} {
        q * cm * 0000ffffff00 *
    }
    # This only tested the presence of an image. Should be improved...
} -cleanup {destroy .c} -result 1

test canvas-3.1 {text} -body {
    canvas .c
    .c create rectangle 0 0 500 500 -outline black
    # Needs 8.5 since underline is 8.5 feature
    if {[catch {.c create text 10 10 -text "Apa\nBepa\nCepa" -underline 5 -anchor nw}]} {
        return 1
    }
    mytest {canvas .c} {
        18.931 36.778 m 26.375 36.778 l S
    }
} -cleanup {destroy .c} -result 1

test canvas-4.1 {sticky} -body {
    # Wide canvas contents
    canvas .c
    .c create rectangle 0 0 500 100 -outline black
    mytest -margin 100 {canvas .c -sticky s} {
        *
    }
} -cleanup {destroy .c} -result 1

test canvas-4.2 {sticky} -body {
    # Tall canvas contents
    canvas .c
    .c create rectangle 0 0 100 500 -outline black
    mytest -margin 100 {canvas .c -sticky e} {
        *
    }
} -cleanup {destroy .c} -result 1

test canvas-20.1 {demo} -constraints apa -body {
    # Find the demo for canvas
    source $::tk_library/demos/widget
    source $::tk_library/demos/items.tcl
    wm deiconify [winfo toplevel .items.frame.c]
    # Scroll down to the widgets to get them mapped
    update
    foreach {x1 x2} [.items.frame.c xview] break
    .items.frame.c xview moveto [expr {1.0 - ($x2 - $x1)}]
    foreach {y1 y2} [.items.frame.c yview] break
    .items.frame.c yview moveto [expr {1.0 - ($y2 - $y1)}]
    update
    mytest -debug {canvas .items.frame.c} {
        *
    }
} -cleanup {destroy .items} -result 1

test canvas-20.2 {demo} -constraints apa -body {
    # Find the goldberg demo for canvas
    set dir $::tk_library/demos
    if {![file exists $dir/goldberg.tcl]} {
        return 1
    }
    source $::tk_library/demos/widget
    source $dir/goldberg.tcl
    wm deiconify [winfo toplevel .goldberg.c]
    update
    mytest -debug {canvas .goldberg.c -bg 1} {
        *
    }
} -cleanup {destroy .goldberg} -result 1

# To make sure we exit even though Tk is loaded
exit
